{"version":3,"file":"bundle.mjs","sources":["../src/abstract-app.ts","../src/web-app.ts","../src/webgl-app.ts"],"sourcesContent":["// vim: tabstop=8 softtabstop=0 noexpandtab shiftwidth=8 nosmarttab\n\nexport type AppParams = {\n\t// URL of the app's main HTML file.\n\tsrc: string;\n\t// Requested duration of the app in seconds.\n\tduration: number;\n} & Record<string, any>;\n\nexport abstract class AbstractApp extends EventTarget {\n\tprotected constructor(\n\t\tpublic readonly params: AppParams,\n\t) {\n\t\tsuper();\n\t\t// Validate the parameters.\n\t\tif(!this.params.src || typeof this.params.src !== 'string') {\n\t\t\tthrow new TypeError('Invalid src parameter');\n\t\t}\n\t\tif(typeof this.params.duration !== 'number' || this.params.duration < 0) {\n\t\t\tthrow new TypeError('Invalid duration parameter');\n\t\t}\n\t}\n\n\t// Release all resources acquired in the init() call.\n\tabstract close(): void;\n\n\t// Called every frame to update the rendering state.\n\tabstract animate(\n\t\tnow: DOMHighResTimeStamp,\n\t\tremaining: number,\n\t): void;\n\n\t// `HTMLMediaElement` instance properties.\n\tabstract currentSrc: string;\n\tabstract currentTime: number;\n\tabstract duration: number;\n\tabstract ended: boolean;\n\tabstract error: any | null;\n\tabstract networkState: number;\n\tabstract paused: boolean;\n\tabstract readyState: number;\n\tabstract src: string;\n\n\tabstract load(): void;\n\tabstract pause(): void;\n\tabstract play(): Promise<void>;\n\n\t// Per `HTMLVideoElement`\n\tabstract height: number;\n\tabstract width: number;\n}\n","// vim: tabstop=8 softtabstop=0 noexpandtab shiftwidth=8 nosmarttab\n\nimport { AbstractApp, AppParams } from './abstract-app.js';\n\nexport abstract class WebApp extends AbstractApp {\n\tprotected _lastTime = 0;\n\tprotected _currentTime = 0;\n\tprotected _duration = 0;\n\tprotected _ended = false;\n\tprotected _error: any | null = null;\n\tprotected _networkState = 0;\n\tprotected _paused = true;\n\tprotected _readyState = 0;\n\n\tprotected constructor(\n\t\tpublic readonly renderRoot: HTMLElement,\n\t\tparams: any,\n\t) {\n\t\tsuper(params);\n\t\t// Use duration set by scheduler, or default to 0.\n\t\tthis._duration = params.duration || 0;\n\t}\n\n\t// Allocate resources for an instance, “renderRoot” is\n\t// the container element, and “renderer”\n\t// is the CSSRenderer instance.\n\tstatic create(\n\t\t_renderRoot: HTMLElement,\n\t\t_params: AppParams,\n\t): WebApp {\n\t\tthrow new Error(\n\t\t\t'WebApp.create() must be implemented by a subclass',\n\t\t);\n\t}\n\n\tclose() {\n\t\tthis.renderRoot.innerHTML = '';\n\t}\n\n\tanimate(\n\t\tnow: DOMHighResTimeStamp,\n\t\t_remaining: number,\n\t): void {\n\t\t// No JavaScript animation.\n\t\tif(this.paused || this.ended) {\n\t\t\treturn;\n\t\t}\n\t\tconst elapsed = (now - this._lastTime) / 1000;\n\t\tthis._currentTime += elapsed;\n\t\tif(this._currentTime < this._duration) {\n\t\t\tthis._lastTime = now;\n\t\t} else {\n\t\t\tthis._currentTime = this._duration;\n\t\t\tif(!this._ended) {\n\t\t\t\tthis._ended = true;\n\t\t\t\tthis.dispatchEvent(new Event('ended'));\n\t\t\t}\n\t\t}\n\t}\n\n\tload(): void {\n\t\t// No resources to load.\n\t\tthis.dispatchEvent(new Event('canplay'));\n\t}\n\n\tpause(): void {\n\t\t// No resources to pause.\n\t\tthis._paused = true;\n\t}\n\n\tplay(): Promise<void> {\n\t\t// No resources to play.\n\t\tthis._lastTime = performance.now();\n\t\tthis._paused = false;\n\t\treturn Promise.resolve();\n\t}\n\n\t// `HTMLMediaElement` instance properties.\n\tget currentSrc(): string {\n\t\treturn this.params.src;\n\t}\n\tget currentTime(): number {\n\t\treturn this._currentTime;\n\t}\n\tget duration(): number {\n\t\treturn this._duration;\n\t}\n\tget ended(): boolean {\n\t\treturn this._ended;\n\t}\n\tget error(): any | null {\n\t\treturn this._error;\n\t}\n\tget networkState(): number {\n\t\treturn this._networkState;\n\t}\n\tget paused(): boolean {\n\t\treturn this._paused;\n\t}\n\tget readyState(): number {\n\t\treturn this._readyState;\n\t}\n\tget src() {\n\t\treturn this.currentSrc;\n\t}\n\n\t// Per `HTMLVideoElement`\n\tget height(): number {\n\t\treturn this.renderRoot.clientHeight;\n\t}\n\tget width(): number {\n\t\treturn this.renderRoot.clientWidth;\n\t}\n}\n\nexport type WebAppConstructor = {\n\tnew (...args: any[]): WebApp;\n\tcreate(\n\t\trenderRoot: HTMLElement,\n\t\tparams: AppParams,\n\t): WebApp;\n};\n","// vim: tabstop=8 softtabstop=0 noexpandtab shiftwidth=8 nosmarttab\n\nimport * as THREE from 'three';\nimport { AbstractApp, AppParams } from './abstract-app.js';\n\nexport abstract class WebGLApp extends AbstractApp {\n\tprotected _lastTime = 0;\n\tprotected _currentTime = 0;\n\tprotected _duration = 0;\n\tprotected _ended = false;\n\tprotected _error: any | null = null;\n\tprotected _networkState = 0;\n\tprotected _paused = true;\n\tprotected _readyState = 0;\n\n\tcamera = new THREE.Camera();\n\tscene = new THREE.Scene();\n\n\tprotected constructor(\n\t\tpublic readonly fbo: THREE.WebGLRenderTarget,\n\t\tpublic readonly renderer: THREE.WebGLRenderer,\n\t\tparams: AppParams,\n\t) {\n\t\tsuper(params);\n\t\t// Use duration set by scheduler, or default to 0.\n\t\tthis._duration = params.duration || 0;\n\t}\n\n\t// Allocate resources for an instance, “fbo” is the\n\t// framebuffer object, i.e. GPU texture, and “renderer”\n\t// is the WebGLRenderer instance.\n\tstatic create(\n\t\t_fbo: THREE.WebGLRenderTarget,\n\t\t_renderer: THREE.WebGLRenderer,\n\t\t_params: AppParams,\n\t): WebGLApp {\n\t\tthrow new Error(\n\t\t\t'WebGLApp.create() must be implemented by a subclass',\n\t\t);\n\t}\n\n\tclose() {\n\t\t// Object3D references.\n\t\tthis.scene.clear();\n\t}\n\n\tprotected _render() {\n\t\tconst width = this.width / this.renderer.getPixelRatio();\n\t\tconst height = this.height / this.renderer.getPixelRatio();\n\n\t\tthis.renderer.setViewport( 0, 0, width, height );\n\n\t\tthis.renderer.setRenderTarget( this.fbo );\n\t\tthis.renderer.render( this.scene, this.camera );\n\t\tthis.renderer.setRenderTarget( null );\n\t}\n\n\tload(): void {\n\t\t// No resources to load.\n\t\tthis.dispatchEvent(new Event('canplay'));\n\t}\n\n\tpause(): void {\n\t\t// No resources to pause.\n\t\tthis._paused = true;\n\t}\n\n\tplay(): Promise<void> {\n\t\t// No resources to play.\n\t\tthis._lastTime = performance.now();\n\t\tthis._paused = false;\n\t\treturn Promise.resolve();\n\t}\n\n\t// `HTMLMediaElement` instance properties.\n\tget currentSrc(): string {\n\t\treturn this.params.src;\n\t}\n\tget currentTime(): number {\n\t\treturn this._currentTime;\n\t}\n\tget duration(): number {\n\t\treturn this._duration;\n\t}\n\tget ended(): boolean {\n\t\treturn this._ended;\n\t}\n\tget error(): any | null {\n\t\treturn this._error;\n\t}\n\tget networkState(): number {\n\t\treturn this._networkState;\n\t}\n\tget paused(): boolean {\n\t\treturn this._paused;\n\t}\n\tget readyState(): number {\n\t\treturn this._readyState;\n\t}\n\tget src() {\n\t\treturn this.currentSrc;\n\t}\n\n\t// Per `HTMLVideoElement`\n\tget height(): number {\n\t\treturn this.fbo.height;\n\t}\n\tget width(): number {\n\t\treturn this.fbo.width;\n\t}\n}\n\nexport type WebGLAppConstructor = {\n\tnew (...args: any[]): WebGLApp;\n\tcreate(\n\t\tfbo: THREE.WebGLRenderTarget,\n\t\trenderer: THREE.WebGLRenderer,\n\t\tparams: AppParams,\n\t): WebGLApp;\n}\n"],"names":[],"mappings":"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"}